#!/bin/bash
set -euo pipefail

usage() {
  cat <<'EOF'
Run private-net-apps as root.

Usage:
  sudo private-net-apps <start|shut|shuffle> [options]

Options (mode start):
  -iface <name>         Interface fisik (default: wlan0)
  -level <basic|1>      Tingkat proteksi:
                        - basic : VPN + Tor biasa (default)
                        - 1     : VPN + Tor via obfs4 bridges (stealth)

Options (mode shuffle): diteruskan ke vpn-shuffle.sh (ONLY_FREE, COUNTRY_ALLOW, INTERVAL)

Examples:
  sudo private-net-apps start
  sudo private-net-apps start -iface eth0 -level 1
  sudo private-net-apps shut
  sudo private-net-apps shuffle once //still developing
EOF
}

[ "$(id -u)" -eq 0 ] || { usage; echo "Run as root"; exit 1; }

MODE="${1:-}"; shift || true

case "${MODE}" in
  start)
    IFACE="wlan0"
    LEVEL="basic"
    while [[ $# -gt 0 ]]; do
      case "$1" in
        -iface) IFACE="${2:-}"; shift 2;;
        -level) LEVEL="${2:-}"; shift 2;;
        *) echo "Unknown option: $1"; usage; exit 1;;
      esac
    done
    IFACE="$IFACE" PRIVNET_LEVEL="$LEVEL" /usr/local/bin/vpn-on.sh
    ;;
  shut)
    /usr/local/bin/vpn-off.sh
    ;;
  shuffle)
    /usr/local/bin/vpn-shuffle.sh "$@"
    ;;
  *)
    usage; exit 1;;
esac