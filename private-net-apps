#!/bin/bash
set -euo pipefail

usage() {
  cat <<'EOF'
Run private-net-apps as root.

Usage:
  sudo private-net-apps [Mode] {Options}

Mode:
  start          start private network apps
  shut           shut down private network apps
  shuffle        shuffle private network apps

Options (hanya untuk mode start):
  -iface <name>        pilih interface (default wlan0)

Arguments (opsional untuk mode shuffle):
  ONLY_FREE=1           only use FREE locations (default 1)
  COUNTRY_ALLOW="US,DE" whitelist countries (2-letter codes)
  INTERVAL=600          rotation interval in seconds
EOF
}

[ "$(id -u)" -eq 0 ] || { usage; echo "Run as root"; exit 1; }

MODE="${1:-}"
shift || true   # geser argumen supaya $@ tinggal options

case "$MODE" in
  start)
    IFACE="wlan0"  # default
    while [[ $# -gt 0 ]]; do
      case "$1" in
        -iface)
          IFACE="$2"
          shift 2
          ;;
        *)
          echo "Unknown option: $1"
          usage
          exit 1
          ;;
      esac
    done
    # jalankan vpn-on.sh dengan iface sebagai env
    IFACE="$IFACE" /usr/local/bin/vpn-on.sh
    ;;
  shut)
    /usr/local/bin/vpn-off.sh
    ;;
  shuffle)
    /usr/local/bin/vpn-shuffle.sh "$@"
    ;;
  *)
    usage
    exit 1
    ;;
esac
